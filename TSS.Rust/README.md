# TSS.Rust

TSS.Rust is a Rust implementation of the TPM 2.0 Software Stack (TSS), providing complete access to the TPM 2.0 API with rich session management and policy support.

## Features

* **Complete TPM 2.0 API** — All TPM 2.0 commands, data structures, enumerations, and unions are auto-generated from the TPM 2.0 specification via [TssCodeGen](../TssCodeGen).
* **HMAC Sessions** — Automatic HMAC computation, nonce rolling, and response HMAC verification.
* **Seeded Sessions** — Salted sessions with RSA-OAEP encrypted salt for enhanced security.
* **Bound Sessions** — Sessions bound to specific TPM entities with optimized HMAC handling.
* **Parameter Encryption** — AES-CFB encryption/decryption of command and response parameters.
* **PolicyTree Abstraction** — Object-oriented representation of TPM policy commands with 14 assertion types, supporting software digest computation and TPM session execution.
* **Software Crypto Helpers** — RSA key operations, OAEP encryption, KDFa key derivation, and HMAC computation bridging software and TPM crypto.
* **Async Command Dispatch** — Support for asynchronous TPM command execution.
* **Cross-platform TPM Access** — Windows TBS device support, with simulator connectivity.

## Building

```bash
cargo build
```

## Running the Samples

The [examples](./examples) directory contains 37 comprehensive samples. To run them against the Windows TBS device (hardware TPM):

```bash
cargo run --example tpm_samples
```

To connect to a TPM simulator:

```bash
cargo run --example tpm_samples -- sim
```

See the [examples README](./examples/README.md) for a full list of samples.

## Architecture

TSS.Rust follows the same architecture as other TSS.MSR implementations:

* **Auto-generated code** (`src/tpm_types.rs`, `src/tpm2.rs`) — Generated by [TssCodeGen](../TssCodeGen) from the TPM 2.0 specification. Do not edit directly.
* **Hand-written library code:**
  - `src/tpm2_impl.rs` — Command dispatch, session handling, marshaling
  - `src/auth_session.rs` — HMAC session management (key derivation, nonce rolling, HMAC computation)
  - `src/crypto.rs` — Cryptographic primitives (AES, RSA, HMAC, KDFa)
  - `src/policy.rs` — PolicyTree abstraction with 14 policy assertion types
  - `src/tpm_type_extensions.rs` — Extension methods on generated types
  - `src/tpm_device.rs` — TPM device abstraction (TBS, simulator)

## Dependencies

Key Rust crates used:
* `rsa`, `sha1`, `sha2`, `hmac` — Cryptographic operations
* `aes`, `cfb-mode` — Symmetric encryption for parameter encryption
* `derivative` — Custom `Default` implementations for generated types
* `windows` — Windows TBS API access

## See Also

* [TSS.CPP](../TSS.CPP) — C++ implementation with similar capabilities
* [TSS.Net](../TSS.NET) — C# implementation
* [TssCodeGen](../TssCodeGen) — Code generator tool
